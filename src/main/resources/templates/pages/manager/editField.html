<th:block th:replace="~{pages/manager/layout-manager :: layout(~{::field_edit_content}, 'fields')}">
    <th:block th:fragment="field_edit_content">

        <div class="container-fluid py-3">

            <!-- Ti√™u ƒë·ªÅ -->
            <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
                <h2 class="h4 mb-0">
                    <i class="fas fa-edit me-2 text-primary"></i>
                    Ch·ªânh s·ª≠a lƒ©nh v·ª±c
                </h2>
                <a th:href="@{/manager/fields}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Quay l·∫°i
                </a>
            </div>

            <!-- Form -->
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow-sm">
                        <div class="card-body p-4">

                            <form th:action="@{'/manager/fields/update/' + ${field.fieldID}}"
                                  th:object="${field}" method="post">

                                <!-- T√™n lƒ©nh v·ª±c -->
                                <div class="mb-4">
                                    <label class="form-label fw-semibold">T√™n lƒ©nh v·ª±c <span class="text-danger">*</span></label>
                                    <input type="text" th:field="*{fieldName}" class="form-control"
                                           placeholder="V√≠ d·ª•: Tr√≠ tu·ªá nh√¢n t·∫°o, An to√†n th√¥ng tin..." required>
                                    <div class="invalid-feedback"
                                         th:if="${#fields.hasErrors('fieldName')}" th:errors="*{fieldName}"></div>
                                </div>

                                <!-- Khoa/Ng√†nh li√™n quan -->
                                <div class="mb-4">
                                    <label class="form-label fw-semibold">Khoa/Ng√†nh li√™n quan</label>

                                    <div class="card">
                                        <div class="card-body department-box">

                                            <!-- √î t√¨m ki·∫øm -->
                                            <div class="input-group mb-3">
                                                <span class="input-group-text bg-light"><i class="fas fa-search"></i></span>
                                                <input type="text" id="searchDepartment" class="form-control" placeholder="T√¨m theo t√™n khoa/ng√†nh...">
                                            </div>

                                            <!-- N·∫øu tr·ªëng -->
                                            <div th:if="${#lists.isEmpty(departments)}" class="text-center text-muted py-3">
                                                Kh√¥ng c√≥ khoa/ng√†nh n√†o.
                                            </div>

                                            <!-- Danh s√°ch -->
                                            <div th:if="${!#lists.isEmpty(departments)}">
                                                <!-- Ch·ªçn t·∫•t c·∫£ -->
                                                <div class="form-check mb-3 border-bottom pb-2">
                                                    <input class="form-check-input" type="checkbox" id="selectAll" onclick="toggleAllDepartments(this)">
                                                    <label class="form-check-label fw-bold" for="selectAll">Ch·ªçn t·∫•t c·∫£</label>
                                                </div>

                                                <div id="departmentList">
                                                    <div th:each="dept : ${departments}" class="form-check mb-2 department-item">
                                                        <input class="form-check-input department-checkbox"
                                                               type="checkbox"
                                                               th:id="'dept-' + ${dept.departmentID}"
                                                               name="departmentIds"
                                                               th:value="${dept.departmentID}"
                                                               th:checked="${field.departments != null and field.departments.contains(dept)}">
                                                        <label class="form-check-label" th:for="'dept-' + ${dept.departmentID}">
                                                            <span th:text="${dept.departmentName}"></span>
                                                            <small class="text-muted">(<span th:text="${dept.type}"></span>)</small>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Buttons -->
                                <div class="d-flex justify-content-end gap-2 mt-3">
                                    <a th:href="@{/manager/fields}" class="btn btn-secondary">
                                        <i class="fas fa-times me-1"></i>H·ªßy
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>C·∫≠p nh·∫≠t lƒ©nh v·ª±c
                                    </button>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .department-box {
                height: 350px;               /* ‚úÖ Chi·ªÅu cao c·ªë ƒë·ªãnh */
                overflow-y: auto;            /* ‚úÖ B·∫≠t thanh cu·ªôn d·ªçc */
                overflow-x: hidden;
            }

            .department-box::-webkit-scrollbar {
                width: 8px;
            }

            .department-box::-webkit-scrollbar-thumb {
                background-color: rgba(0, 0, 0, 0.2);
                border-radius: 4px;
            }
        </style>
        <!-- Script ch·ªçn t·∫•t c·∫£ -->
        <script>
            // Ch·ª©c nƒÉng ch·ªçn t·∫•t c·∫£
            function toggleAllDepartments(source) {
                const checkboxes = document.querySelectorAll('.department-checkbox');
                checkboxes.forEach(cb => cb.checked = source.checked);
            }

            document.addEventListener('DOMContentLoaded', () => {
                const checkboxes = document.querySelectorAll('.department-checkbox');
                const selectAll = document.getElementById('selectAll');

                if (selectAll && checkboxes.length > 0) {
                    checkboxes.forEach(cb => cb.addEventListener('change', () => {
                        selectAll.checked = Array.from(checkboxes).every(c => c.checked);
                    }));
                    selectAll.checked = Array.from(checkboxes).every(c => c.checked);
                }

                // üîç Ch·ª©c nƒÉng t√¨m ki·∫øm theo t√™n khoa/ng√†nh
                const searchInput = document.getElementById('searchDepartment');
                const departmentItems = document.querySelectorAll('.department-item');

                if (searchInput) {
                    searchInput.addEventListener('input', function () {
                        const keyword = this.value.toLowerCase().trim();
                        departmentItems.forEach(item => {
                            const text = item.textContent.toLowerCase();
                            item.style.display = text.includes(keyword) ? '' : 'none';
                        });
                    });
                }
            });
        </script>

    </th:block>
</th:block>
