<th:block th:replace="~{pages/manager/layout-manager :: layout(~{::bad_contents}, 'bad-contents')}">
    <th:block th:fragment="bad_contents">

        <div class="container-fluid py-3">
            <!-- Tiêu đề trang -->
            <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
                <h2 class="h4 mb-0">
                    <i class="fas fa-robot me-2 text-danger"></i>AI lọc nội dung xấu cho câu hỏi
                </h2>
            </div>

            <!-- Thông báo cảnh báo -->
            <div class="alert alert-warning d-flex align-items-center mb-4" role="alert">
                <i class="fas fa-exclamation-triangle fa-lg me-3"></i>
                <div>
                    <strong>Lưu ý:</strong> Khi <strong>APPROVED</strong>, câu hỏi sẽ chuyển trạng thái "APPROVED".
                    Khi <strong>REJECTED</strong>, sẽ chuyển sang trạng thái "REJECTED".
                </div>
            </div>

            <!-- Bộ lọc tìm kiếm -->
            <form method="get" class="row gy-2 gx-3 mb-4">
                <div class="col-md-4">
                    <label for="startDate" class="form-label fw-semibold">
                        <i class="fas fa-calendar-day me-1"></i>Từ ngày giờ
                    </label>
                    <input type="datetime-local" id="startDate" name="startDate"
                           class="form-control" th:value="${startDate}">
                </div>
                <div class="col-md-4">
                    <label for="endDate" class="form-label fw-semibold">
                        <i class="fas fa-calendar-check me-1"></i>Đến ngày giờ
                    </label>
                    <input type="datetime-local" id="endDate" name="endDate"
                           class="form-control" th:value="${endDate}">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary fw-semibold px-3 w-100" style="margin-top: 31px;">
                        <i class="fas fa-search me-1"></i> Lọc kết quả
                    </button>
                </div>
            </form>

            <!-- Bảng danh sách nội dung xấu -->
            <div class="card shadow-sm">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-primary">
                            <tr>
                                <th class="text-center" style="width: 5%;">ID</th>
                                <th style="width: 15%;">Tiêu đề</th>
                                <th style="width: 25%;">Nội dung</th>
                                <th style="width: 12%;">Người gửi</th>
                                <th class="text-center" style="width: 12%;">Ngày gửi</th>
                                <th class="text-center" style="width: 9%;">Trạng thái</th>
                                <th class="text-center" style="width: 17%;">Hành động</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="q : ${toxicPage.content}"
                                th:classappend="${q.status.name() == 'PENDING'} ? 'table-warning' : ''">

                                <!-- ID -->
                                <td class="text-center" th:text="${q.questionID}"></td>

                                <!-- Tiêu đề -->
                                <td th:text="${q.title}" class="fw-semibold"></td>

                                <!-- Nội dung -->
                                <td style="max-width: 300px;">
                                    <div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                        <span th:text="${q.content}"></span>
                                    </div>
                                    <button type="button"
                                            class="btn btn-link text-primary p-0 mt-1"
                                            style="font-size: 12px;"
                                            data-bs-toggle="modal"
                                            th:data-bs-target="'#viewContentModal-' + ${q.questionID}">
                                        <i class="fas fa-eye me-1"></i>Xem chi tiết
                                    </button>
                                </td>

                                <!-- Người gửi -->
                                <td th:text="${q.user.profile.fullName}"></td>

                                <!-- Ngày gửi -->
                                <td class="text-center" th:text="${#temporals.format(q.dateSend, 'dd/MM/yyyy HH:mm')}"></td>

                                <!-- Trạng thái -->
                                <td class="text-center">
                                    <span class="badge"
                                          th:classappend="${q.status.name() == 'PENDING' ? ' bg-warning text-dark' :
                                                          (q.status.name() == 'APPROVED' ? ' bg-success' : ' bg-danger')}">
                                        <span th:text="${q.status}"></span>
                                    </span>
                                </td>

                                <!-- Hành động -->
                                <td class="text-center">
                                    <div class="btn-group" role="group">
                                        <form th:action="@{/manager/bad-contents/approved/{id}(id=${q.questionID})}"
                                              method="post" class="d-inline">
                                            <button type="submit"
                                                    class="btn btn-sm btn-success"
                                                    title="APPROVED">
                                                <i class="fas fa-check"></i>
                                            </button>
                                        </form>
                                        <form th:action="@{/manager/bad-contents/rejected/{id}(id=${q.questionID})}"
                                              method="post" class="d-inline">
                                            <button type="submit"
                                                    class="btn btn-sm btn-outline-danger"
                                                    title="REJECTED">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>

                            <!-- Trường hợp không có dữ liệu -->
                            <tr th:if="${toxicPage.content.isEmpty()}">
                                <td colspan="7" class="text-center text-muted py-4">
                                    Không có nội dung xấu nào trong khoảng thời gian này.
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Phân trang -->
                <div class="card-footer" th:if="${totalPages > 0}">
                    <nav aria-label="Phân trang nội dung xấu">
                        <ul class="pagination justify-content-center mb-0">
                            <!-- Nút Previous -->
                            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                                <a class="page-link"
                                   th:href="@{/manager/bad-contents(page=${currentPage - 1}, startDate=${startDate}, endDate=${endDate})}"
                                   aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>

                            <!-- Số trang -->
                            <li class="page-item"
                                th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                th:classappend="${i == currentPage} ? 'active'">
                                <a class="page-link"
                                   th:href="@{/manager/bad-contents(page=${i}, startDate=${startDate}, endDate=${endDate})}"
                                   th:text="${i + 1}">1</a>
                            </li>

                            <!-- Nút Next -->
                            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                                <a class="page-link"
                                   th:href="@{/manager/bad-contents(page=${currentPage + 1}, startDate=${startDate}, endDate=${endDate})}"
                                   aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>

                    <!-- Thông tin phân trang -->
                    <div class="text-center mt-2 text-muted">
                        <small>
                            Trang <span th:text="${currentPage + 1}">1</span> / <span th:text="${totalPages}">1</span>
                            (Tổng <span th:text="${toxicPage.totalElements}">0</span> nội dung)
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal xem chi tiết nội dung -->
        <div th:each="q : ${toxicPage.content}"
             th:id="'viewContentModal-' + ${q.questionID}"
             class="modal fade"
             tabindex="-1"
             aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-danger text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-eye me-2"></i>Chi tiết nội dung vi phạm
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <strong>Tiêu đề:</strong>
                            <span th:text="${q.title}" class="text-primary"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Người gửi:</strong>
                            <span th:text="${q.user.profile.fullName}"></span>
                        </div>
                        <div class="mb-3">
                            <strong>Ngày gửi:</strong>
                            <span th:text="${#temporals.format(q.dateSend, 'dd/MM/yyyy HH:mm')}"></span>
                        </div>
                        <hr>
                        <div class="mb-2"><strong>Nội dung:</strong></div>
                        <div class="p-3 border rounded bg-light"
                             style="white-space: pre-wrap; max-height: 400px; overflow-y: auto;">
                            <span th:text="${q.content}"></span>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <form th:action="@{/manager/bad-contents/approved/{id}(id=${q.questionID})}"
                              method="post" class="d-inline">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-check me-1"></i>Approved
                            </button>
                        </form>
                        <form th:action="@{/manager/bad-contents/rejected/{id}(id=${q.questionID})}"
                              method="post" class="d-inline">
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-times me-1"></i>Rejected
                            </button>
                        </form>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    </div>
                </div>
            </div>
        </div>

    </th:block>
</th:block>