<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<!-- include head fragment, truyền title -->
<th:block th:replace="~{fragments/head :: head('QAUTE - Trang Tư vấn viên')}"></th:block>
<body>
<!-- Navigation - Using consultant-navbar fragment -->
<th:block th:replace="~{fragments/consultant/consultant-navbar :: consultant-navbar}"></th:block>

<!-- Main Content -->
<main style="padding-top: 30px;">
    <!-- Dashboard Content -->
    <div class="container-fluid">
        <th:block th:replace="~{fragments/consultant/consultant-dashboard :: consultant-dashboard}"></th:block>
    </div>
</main>

<!-- Hero Section (phần icon chat) -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6 text-center">
                <div class="mt-5 mt-lg-0">
                    <div id="chat-animation" class="chat-animation"></div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Quick Actions -->
<section class="bg-light py-4">
    <div class="container">
        <div class="row g-3">
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100 text-center">
                    <div class="card-body py-3">
                        <i class="fas fa-question-circle text-primary fa-2x mb-2"></i>
                        <h6 class="mb-1">Đặt câu hỏi mới</h6>
                        <small class="text-muted">Tư vấn nhanh chóng</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100 text-center">
                    <div class="card-body py-3">
                        <i class="fas fa-comments text-success fa-2x mb-2"></i>
                        <h6 class="mb-1">Chat với tư vấn viên</h6>
                        <small class="text-muted">3 tư vấn viên online</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100 text-center">
                    <div class="card-body py-3">
                        <i class="fas fa-history text-info fa-2x mb-2"></i>
                        <h6 class="mb-1">Lịch sử tư vấn</h6>
                        <small class="text-muted">Xem lại câu hỏi cũ</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card border-0 shadow-sm h-100 text-center">
                    <div class="card-body py-3">
                        <i class="fas fa-star text-warning fa-2x mb-2"></i>
                        <h6 class="mb-1">Câu hỏi được quan tâm</h6>
                        <small class="text-muted">Trending hôm nay</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="bg-white py-5">
    <div class="container">
        <div class="row text-center">
            <div class="col-md-3 mb-4">
                <div class="h2 text-primary fw-bold">5,000+</div>
                <p class="mb-0 text-muted">Sinh viên tham gia</p>
            </div>
            <div class="col-md-3 mb-4">
                <div class="h2 text-success fw-bold">50+</div>
                <p class="mb-0 text-muted">Tư vấn viên chuyên nghiệp</p>
            </div>
            <div class="col-md-3 mb-4">
                <div class="h2 text-warning fw-bold">24/7</div>
                <p class="mb-0 text-muted">Hỗ trợ trực tuyến</p>
            </div>
            <div class="col-md-3 mb-4">
                <div class="h2 text-info fw-bold">98%</div>
                <p class="mb-0 text-muted">Mức độ hài lòng</p>
            </div>
        </div>
    </div>
</section>


<!-- About Section -->
<section id="about" class="bg-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h2 class="fw-bold mb-4">Về QAUTE</h2>
                <p class="lead mb-4">
                    QAUTE là nền tảng tư vấn trực tuyến hàng đầu dành cho sinh viên Việt Nam.
                    Chúng tôi kết nối sinh viên với các chuyên gia tư vấn và tạo ra một cộng đồng
                    hỗ trợ lẫn nhau trong học tập và phát triển cá nhân.
                </p>
                <div class="row">
                    <div class="col-sm-6 mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-check text-primary me-2"></i>
                            <span>Tư vấn 24/7</span>
                        </div>
                    </div>
                    <div class="col-sm-6 mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-check text-primary me-2"></i>
                            <span>Chuyên gia giàu kinh nghiệm</span>
                        </div>
                    </div>
                    <div class="col-sm-6 mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-check text-primary me-2"></i>
                            <span>Cộng đồng sôi động</span>
                        </div>
                    </div>
                    <div class="col-sm-6 mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-check text-primary me-2"></i>
                            <span>Hoàn toàn miễn phí</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 text-center">
                <div class="mt-5 mt-lg-0">
                    <i class="fas fa-university fa-10x text-primary opacity-25"></i>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Section -->
<section id="contact" class="bg-primary text-white py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold mb-3">Liên hệ với chúng tôi</h2>
            <p class="lead">Có thắc mắc? Chúng tôi luôn sẵn sàng hỗ trợ bạn!</p>
        </div>
        <div class="row g-4">
            <div class="col-lg-4 text-center">
                <div class="bg-white bg-opacity-10 rounded-3 p-4">
                    <i class="fas fa-map-marker-alt fa-3x mb-3"></i>
                    <h5>Địa chỉ</h5>
                    <p class="mb-0">123 Đường ABC, Quận 1<br>TP.HCM, Việt Nam</p>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <div class="bg-white bg-opacity-10 rounded-3 p-4">
                    <i class="fas fa-phone fa-3x mb-3"></i>
                    <h5>Điện thoại</h5>
                    <p class="mb-0">(028) 1234 5678<br>Hotline: 1900 1234</p>
                </div>
            </div>
            <div class="col-lg-4 text-center">
                <div class="bg-white bg-opacity-10 rounded-3 p-4">
                    <i class="fas fa-envelope fa-3x mb-3"></i>
                    <h5>Email</h5>
                    <p class="mb-0">info@qaute.edu.vn<br>support@qaute.edu.vn</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Floating Ask Question Button -->
<!-- <div class="position-fixed bottom-0 end-0 m-4">
    <button class="btn btn-warning rounded-circle shadow-lg" style="width: 60px; height: 60px;" data-bs-toggle="modal" data-bs-target="#askQuestionModal">
        <i class="fas fa-question-circle fa-lg"></i>
    </button>
</div> -->

<!-- Ask Question Modal -->
<div class="modal fade" id="askQuestionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title text-dark">
                    <i class="fas fa-question-circle me-2"></i>Đặt câu hỏi mới
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="questionTitle" class="form-label">Tiêu đề câu hỏi</label>
                        <input type="text" class="form-control" id="questionTitle" placeholder="Tóm tắt câu hỏi của bạn...">
                    </div>
                    <div class="mb-3">
                        <label for="questionContent" class="form-label">Nội dung chi tiết</label>
                        <textarea class="form-control" id="questionContent" rows="5" placeholder="Mô tả chi tiết vấn đề bạn đang gặp phải..."></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="questionCategory" class="form-label">Chủ đề</label>
                            <select class="form-select" id="questionCategory">
                                <option value="">Chọn chủ đề</option>
                                <option value="academic">Học tập</option>
                                <option value="career">Nghề nghiệp</option>
                                <option value="psychology">Tâm lý</option>
                                <option value="study-abroad">Du học</option>
                                <option value="internship">Thực tập</option>
                                <option value="skills">Kỹ năng</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="questionUrgency" class="form-label">Mức độ khẩn cấp</label>
                            <select class="form-select" id="questionUrgency">
                                <option value="low">Không khẩn cấp</option>
                                <option value="medium">Khẩn cấp vừa</option>
                                <option value="high">Rất khẩn cấp</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="anonymousQuestion">
                            <label class="form-check-label" for="anonymousQuestion">
                                Đặt câu hỏi ẩn danh
                            </label>
                        </div>
                    </div>
                </form>

                <!-- Suggested Consultants -->
                <div class="mt-4">
                    <h6 class="fw-bold">Tư vấn viên phù hợp:</h6>
                    <div class="row g-2">
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body p-3">
                                    <div class="d-flex align-items-center">
                                        <img src="https://via.placeholder.com/40" class="rounded-circle me-2" alt="Consultant">
                                        <div>
                                            <div class="fw-semibold small">TS. Nguyễn Thị Lan</div>
                                            <small class="text-muted">Chuyên gia Tâm lý</small>
                                            <div class="text-success small">
                                                <i class="fas fa-circle me-1"></i>Online
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 bg-light">
                                <div class="card-body p-3">
                                    <div class="d-flex align-items-center">
                                        <img src="https://via.placeholder.com/40" class="rounded-circle me-2" alt="Consultant">
                                        <div>
                                            <div class="fw-semibold small">ThS. Trần Văn Minh</div>
                                            <small class="text-muted">Chuyên gia Nghề nghiệp</small>
                                            <div class="text-success small">
                                                <i class="fas fa-circle me-1"></i>Online
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-warning">
                    <i class="fas fa-paper-plane me-2"></i>Gửi câu hỏi
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Chat Modal -->
<div class="modal fade" id="chatModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-comments me-2"></i>Chat với Tư vấn viên
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-4 border-end">
                        <h6 class="fw-bold mb-3">Tư vấn viên Online</h6>
                        <div class="list-group list-group-flush">
                            <a href="#" class="list-group-item list-group-item-action d-flex align-items-center">
                                <div class="position-relative me-3">
                                    <img src="https://via.placeholder.com/40" class="rounded-circle" alt="Consultant">
                                    <span class="position-absolute bottom-0 end-0 bg-success border border-white rounded-circle" style="width: 12px; height: 12px;"></span>
                                </div>
                                <div>
                                    <div class="fw-semibold">TS. Nguyễn Thị Lan</div>
                                    <small class="text-muted">Tâm lý học</small>
                                </div>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action d-flex align-items-center">
                                <div class="position-relative me-3">
                                    <img src="https://via.placeholder.com/40" class="rounded-circle" alt="Consultant">
                                    <span class="position-absolute bottom-0 end-0 bg-success border border-white rounded-circle" style="width: 12px; height: 12px;"></span>
                                </div>
                                <div>
                                    <div class="fw-semibold">ThS. Trần Văn Minh</div>
                                    <small class="text-muted">Nghề nghiệp</small>
                                </div>
                            </a>
                            <a href="#" class="list-group-item list-group-item-action d-flex align-items-center">
                                <div class="position-relative me-3">
                                    <img src="https://via.placeholder.com/40" class="rounded-circle" alt="Consultant">
                                    <span class="position-absolute bottom-0 end-0 bg-warning border border-white rounded-circle" style="width: 12px; height: 12px;"></span>
                                </div>
                                <div>
                                    <div class="fw-semibold">PGS. Lê Thị Hương</div>
                                    <small class="text-muted">Giáo dục - Bận</small>
                                </div>
                            </a>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="text-center text-muted py-5">
                            <i class="fas fa-comment-dots fa-3x mb-3 opacity-50"></i>
                            <p>Chọn một tư vấn viên để bắt đầu cuộc trò chuyện</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Include chat bubble fragment -->
<div th:replace="~{fragments/chat-bubble :: chat-bubble}"></div>

<!-- Include footer fragment -->
<div th:replace="~{fragments/footer :: footer}"></div>
<script th:inline="javascript">
    // Dữ liệu gốc từ backend
    const originalData = {
        questionsByField: /*[[${questionsByField}]]*/ {},
        questionsByDay: /*[[${questionsByDay}]]*/ {},
        questionsByWeek: /*[[${questionsByWeek}]]*/ {},
        questionsByMonth: /*[[${questionsByMonth}]]*/ {},
        totalQuestionsAnswered: /*[[${totalQuestionsAnswered}]]*/ 0,
        responseRate: /*[[${responseRate}]]*/ 0,
        avgResponseTime: /*[[${avgResponseTime}]]*/ 0,
        totalUsersAnswered: /*[[${totalUsersAnswered}]]*/ 0
    };

    let currentPieChart, currentLineChart;

    // Hàm vẽ pie chart
    function drawPieChart(data) {
        if (currentPieChart) currentPieChart.destroy();
        if (Object.keys(data).length > 0) {
            const labels = Object.keys(data);
            const values = Object.values(data);
            const ctx = document.getElementById('categoryChart').getContext('2d');
            currentPieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return context.label + ': ' + percentage + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
    }

    // Hàm vẽ line chart
    function drawLineChart(data) {
        if (currentLineChart) currentLineChart.destroy();
        const labels = Object.keys(data);
        const values = Object.values(data);
        const ctx = document.getElementById('timeChart').getContext('2d');
        currentLineChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Số câu hỏi đã trả lời',
                    data: values,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: true } }
            }
        });
    }

    // Hàm filter theo thời gian
    function filterByTime(period) {
        let filteredQuestionsByField = originalData.questionsByField;
        let filteredQuestionsByTime = originalData.questionsByWeek; // Default
        let filteredTotal = originalData.totalQuestionsAnswered;

        if (period === 'hôm nay') {
            // Giả lập filter cho hôm nay (có thể mở rộng với date logic)
            filteredQuestionsByTime = {}; // Placeholder
            filteredTotal = Math.floor(originalData.totalQuestionsAnswered * 0.1); // Giả lập
        } else if (period === 'tuần này') {
            filteredQuestionsByTime = originalData.questionsByWeek;
        } else if (period === 'tháng này') {
            filteredQuestionsByTime = originalData.questionsByMonth;
        } else if (period === 'năm nay') {
            // Giả lập cho năm
            filteredQuestionsByTime = originalData.questionsByMonth; // Placeholder
        } else if (period === 'tất cả') {
            filteredQuestionsByTime = originalData.questionsByMonth; // Placeholder
        }

        // Update stats
        document.getElementById('totalQuestionsAnswered').textContent = filteredTotal;
        document.getElementById('responseRate').textContent = (filteredTotal / originalData.totalQuestionsAnswered * 100).toFixed(1) + '%';
        // Update các card khác tương tự

        // Update biểu đồ
        drawPieChart(filteredQuestionsByField);
        drawLineChart(filteredQuestionsByTime);
    }

    // Khởi tạo
    drawPieChart(originalData.questionsByField);
    drawLineChart(originalData.questionsByWeek);

    // Event listener cho button group (giữ nguyên)
    document.getElementById('timeButtons').addEventListener('click', function(e) {
        if (e.target.tagName === 'BUTTON') {
            document.querySelectorAll('#timeButtons button').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            const period = e.target.getAttribute('data-period');
            if (period === 'day') drawLineChart(originalData.questionsByDay);
            else if (period === 'week') drawLineChart(originalData.questionsByWeek);
            else if (period === 'month') drawLineChart(originalData.questionsByMonth);
        }
    });

    // Event listener cho dropdown
    document.querySelector('.dropdown-menu').addEventListener('click', function(e) {
        if (e.target.classList.contains('dropdown-item')) {
            const period = e.target.textContent.toLowerCase();
            document.querySelector('.dropdown-toggle').innerHTML = '<i class="fas fa-calendar-alt me-1"></i> ' + e.target.textContent;
            filterByTime(period);
        }
    });
</script>
</body>
</html>