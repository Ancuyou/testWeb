<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<!-- include head fragment, truyền title -->
<th:block th:replace="~{fragments/head :: head('QAUTE - Lịch sử tư vấn')}"></th:block>
<body>
<!-- Navigation - Using consultant-navbar fragment -->
<th:block th:replace="~{fragments/consultant/consultant-navbar :: consultant-navbar}"></th:block>

<!-- Main Content -->
<main style="padding-top: 70px;">
    <!-- History Content -->
    <div class="container">
        <div class="row my-4">
            <div class="col-12">
                <h2 class="mb-4">Lịch sử tư vấn</h2>
                
                <!-- Filter options -->
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <form th:action="@{/consultant/history}" method="get">
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <label class="form-label">Loại hoạt động</label>
                                    <select class="form-select" name="type">
                                        <option value="" selected>Tất cả</option>
                                        <option value="question">Câu hỏi</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label class="form-label">Thời gian</label>
                                    <select class="form-select" name="timeRange">
                                        <option value="" selected>Tất cả</option>
                                        <option value="7">7 ngày qua</option>
                                        <option value="30">30 ngày qua</option>
                                        <option value="90">3 tháng qua</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Từ khóa</label>
                                    <input type="text" class="form-control" name="keyword" placeholder="Tìm kiếm theo tiêu đề hoặc nội dung...">
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="fas fa-search me-2"></i>Lọc
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Statistics Summary -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card shadow-sm text-center">
                            <div class="card-body">
                                <h5 class="text-primary" th:text="${totalAnswers}">0</h5>
                                <p class="mb-0 text-muted">Tổng số câu trả lời</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card shadow-sm text-center">
                            <div class="card-body">
                                <h5 class="text-success" th:text="${uniqueQuestions}">0</h5>
                                <p class="mb-0 text-muted">Số câu hỏi đã tư vấn</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card shadow-sm text-center">
                            <div class="card-body">
                                <h5 class="text-info" th:text="${uniqueUsers}">0</h5>
                                <p class="mb-0 text-muted">Số người được tư vấn</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- History List -->
                <div class="card shadow-sm">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">Danh sách câu trả lời</h6>
                    </div>
                    <div class="list-group list-group-flush">
                        <!-- Check if list is empty -->
                        <div th:if="${#lists.isEmpty(answersHistory)}" class="list-group-item p-4 text-center">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <p class="text-muted mb-0">Chưa có lịch sử tư vấn nào.</p>
                        </div>
                        
                        <!-- Loop through answers -->
                        <div th:each="answer : ${answersHistory}" class="list-group-item p-3 hover-item">
                            <div class="row">
                                <div class="col-md-9">
                                    <h6 class="mb-2">
                                        <i class="fas fa-question-circle text-primary me-2"></i>
                                        <span th:text="${answer.title}">Tiêu đề câu hỏi</span>
                                    </h6>
                                    <p class="mb-2 text-muted small">
                                        <i class="fas fa-user me-1"></i> 
                                        <span th:text="${answer.userName}">Tên người hỏi</span>
                                        <span class="mx-2">|</span>
                                        <i class="fas fa-calendar me-1"></i>
                                        Hỏi: <span th:text="${#temporals.format(answer.createdAt, 'dd/MM/yyyy HH:mm')}">Thời gian</span>
                                    </p>
                                    
                                    <!-- Question Content Preview -->
                                    <div class="bg-light p-2 rounded mb-2">
                                        <p class="mb-0 small">
                                            <strong>Câu hỏi:</strong> 
                                            <span th:text="${#strings.length(answer.contentQuestion) > 150 ? #strings.substring(answer.contentQuestion, 0, 150) + '...' : answer.contentQuestion}">Nội dung câu hỏi...</span>
                                        </p>
                                    </div>
                                    
                                    <!-- Answer Content Preview -->
                                    <div class="bg-success bg-opacity-10 p-2 rounded">
                                        <p class="mb-0 small">
                                            <strong class="text-success">Câu trả lời của bạn:</strong> 
                                            <span th:text="${#strings.length(answer.contentAnswer) > 150 ? #strings.substring(answer.contentAnswer, 0, 150) + '...' : answer.contentAnswer}">Nội dung câu trả lời...</span>
                                        </p>
                                    </div>
                                </div>
                                
                                <div class="col-md-3 text-end d-flex flex-column justify-content-between">
                                    <div>
                                        <span class="badge bg-success mb-2">
                                            <i class="fas fa-check me-1"></i>Đã trả lời
                                        </span>
                                        <p class="mb-1 text-muted small">
                                            <i class="fas fa-clock me-1"></i>
                                            <span th:text="${#temporals.format(answer.answerAt, 'dd/MM/yyyy HH:mm')}">Thời gian trả lời</span>
                                        </p>
                                    </div>
                                    
                                    <div class="mt-2">
                                        <a th:href="@{/consultant/question-details/{id}(id=${answer.questionID})}" 
                                           class="btn btn-sm btn-outline-primary w-100">
                                            <i class="fas fa-eye me-1"></i>Xem chi tiết
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pagination -->
               <nav class="mt-4" th:if="${totalPages > 1}">
                    <ul class="pagination justify-content-center">
                        <!-- Previous button -->
                        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                            <a class="page-link"
                            th:href="@{/consultant/history(page=${currentPage - 1}, size=${pageSize}, type=${param.type}, timeRange=${param.timeRange}, keyword=${param.keyword})}">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                        <!-- Page numbers -->
                        <li class="page-item"
                            th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                            th:classappend="${i == currentPage} ? 'active'">
                            <a class="page-link"
                            th:href="@{/consultant/history(page=${i}, size=${pageSize}, type=${param.type}, timeRange=${param.timeRange}, keyword=${param.keyword})}"
                            th:text="${i + 1}">1</a>
                        </li>
                        <!-- Next button -->
                        <li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
                            <a class="page-link"
                            th:href="@{/consultant/history(page=${currentPage + 1}, size=${pageSize}, type=${param.type}, timeRange=${param.timeRange}, keyword=${param.keyword})}">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</main>

<!-- Footer -->
<th:block th:replace="~{fragments/footer :: footer}"></th:block>

<style>
    .hover-item {
        transition: all 0.3s ease;
    }
    
    .hover-item:hover {
        background-color: #f8f9fa;
        transform: translateX(5px);
    }
    
    .bg-opacity-10 {
        --bs-bg-opacity: 0.1;
    }
</style>
</body>
</html>